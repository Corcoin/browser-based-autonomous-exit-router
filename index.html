<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Static 10-Exit Router Demo</title>
<style>
body { font-family: sans-serif; padding: 20px; }
h1, h2 { margin-bottom: 10px; }
#log, #response { white-space: pre-wrap; background: #f4f4f4; padding: 10px; height: 200px; overflow-y: scroll; border: 1px solid #ccc; margin-bottom: 20px; }
.exit-page { margin: 10px 0; padding: 10px; border: 1px dashed #888; }
button { padding: 10px 20px; margin-bottom: 10px; }
table { border-collapse: collapse; width: 100%; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 6px; text-align: left; }
</style>
</head>
<body>

<h1>Static 10-Exit Router Demo</h1>
<p>Type a website or domain below to route it through our static exits.</p>

<input type="text" id="urlInput" placeholder="Enter domain e.g. youtube.com" style="width:300px; padding:5px;">
<button onclick="routeURL()">Route URL</button>

<h2>Live Log</h2>
<div id="log"></div>

<h2>Exit Response</h2>
<div id="response"></div>

<h2>Analytics Dashboard</h2>
<table id="analytics">
<thead>
<tr><th>Route</th><th>Hits</th></tr>
</thead>
<tbody></tbody>
</table>

<h2>Exit Pages</h2>
<div id="exitPages"></div>

<script>
// ---------------------------
// Routing Table + Exits
const ROUTES = {
  "fast": ["youtube.com", "google.com"],
  "low_latency": ["discord.com", "zoom.us"],
  "bulk": ["windowsupdate.com", "apple.com"]
};

const EXITS = {
  "fast": ["route1.html","route2.html","route3.html"],
  "low_latency": ["route4.html","route5.html","route6.html"],
  "bulk": ["route7.html","route8.html","route9.html"],
  "default": ["route10.html"]
};

const CALL_COUNTS = {};

// Display exit pages
const container = document.getElementById("exitPages");
for(let i=1;i<=10;i++){
  const div = document.createElement("div");
  div.className="exit-page";
  div.textContent=`Route ${i}: route${i}.html`;
  container.appendChild(div);
}

// ---------------------------
// Helpers
function log(msg){
  const el = document.getElementById("log");
  el.textContent += msg + "\n";
  el.scrollTop = el.scrollHeight;
}

function classifyHost(hostname){
  hostname = hostname.toLowerCase();
  for(const [bucket, domains] of Object.entries(ROUTES)){
    for(const d of domains){
      if(hostname.endsWith(d)) return bucket;
    }
  }
  return "default";
}

function selectExit(bucket){
  const exits = EXITS[bucket] || EXITS["default"];
  return exits[Math.floor(Math.random()*exits.length)];
}

function updateAnalytics(){
  const tbody = document.querySelector("#analytics tbody");
  tbody.innerHTML = "";
  for(const exit of Object.values(EXITS).flat()){
    const hits = CALL_COUNTS[exit] || 0;
    tbody.innerHTML += `<tr><td>${exit}</td><td>${hits}</td></tr>`;
  }
}

// ---------------------------
// Main routing function
async function routeURL(){
  const url = document.getElementById("urlInput").value.trim();
  if(!url) return alert("Enter a URL or domain!");

  const bucket = classifyHost(url);
  let exit = selectExit(bucket);

  try{
    const res = await fetch(exit, {mode:"cors"});
    const html = await res.text();
    CALL_COUNTS[exit] = (CALL_COUNTS[exit] || 0) + 1;

    log(`[CALL] ${url} -> ${exit} (${bucket})`);
    document.getElementById("response").innerHTML = html; // Render HTML
    updateAnalytics();
  }catch(e){
    log(`[FAIL] ${url} -> ${exit}: ${e}`);
    // failover
    const otherExits = EXITS[bucket].filter(e=>e!==exit);
    if(otherExits.length>0){
      exit = otherExits[Math.floor(Math.random()*otherExits.length)];
      log(`[RETRY] Trying failover exit ${exit}`);
      routeURL(); // retry
    }
  }
}
</script>
</body>
</html>
